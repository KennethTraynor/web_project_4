(()=>{"use strict";var e={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const n=function(){function e(t,n){var r=t.items,o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._items=r.sort((function(e,t){return Date.parse(e.createdAt)-Date.parse(t.createdAt)})),this._renderer=o,this._wrapper=document.querySelector(n)}var n,r;return n=e,(r=[{key:"renderer",value:function(){var e=this;this._items.forEach((function(t){e._renderer(t)}))}},{key:"addItem",value:function(e){this._wrapper.prepend(e)}}])&&t(n.prototype,r),e}();var r=function(e){return new Promise((function(t,n){var r=new Image;r.src=e,r.onload=function(){return t(r)},r.onerror=function(){return n("Failed to load image")}}))};function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const i=function(){function e(t,n){var r=t.data,o=t.handleCardClick,i=t.handleDeleteClick,a=t.handleLikeClick;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._link=r.link,this._name=r.name,this._id=r._id,this._likes=r.likes.map((function(e){return e._id})),this._owner=r.owner,this._templateSelector=n,this._handleCardClick=o,this._handleDeleteClick=i,this._handleLikeClick=a}var t,n;return t=e,(n=[{key:"_getCardTemplate",value:function(){return document.querySelector(this._templateSelector).content.querySelector(".element")}},{key:"getLiked",value:function(e){var t=e.userID;return this._likes.some((function(e){return e==t}))}},{key:"updateLiked",value:function(e){var t=e.userID,n=e.likes;this._likes=n.map((function(e){return e._id})),this.getLiked({userID:t})?this._card.querySelector(".element__like-button").classList.add("element__like-button_active"):this._card.querySelector(".element__like-button").classList.remove("element__like-button_active"),this._card.querySelector(".element__like-count").textContent=this._likes.length.toString()}},{key:"_setEventListeners",value:function(e){var t=this,n=e.userID;this._card.querySelector(".element__image").addEventListener("click",(function(){return t._handleCardClick(t._name,t._link)})),this._card.querySelector(".element__like-button").addEventListener("click",(function(){return t._handleLikeClick({cardID:t._id,card:t})})),this._owner._id==n&&this._card.querySelector(".element__delete-button").addEventListener("click",(function(){return t._handleDeleteClick({cardID:t._id,cardElement:t._card})}))}},{key:"generateCard",value:function(e){var t=this,n=e.userID;this._card=this._getCardTemplate().cloneNode(!0);var o=this._card.querySelector(".element__image"),i=this._card.querySelector(".element__text");return r(this._link).then((function(e){o.src=e.src,o.alt=t._name})).catch((function(e){return console.log(e)})),i.textContent=this._name,this._owner._id!==n&&this._card.querySelector(".element__delete-button").remove(),this._setEventListeners({userID:n}),this._card}}])&&o(t.prototype,n),e}();function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const u=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputErrorClass=t.inputErrorClass,this._submitButtonSelector=t.submitButtonSelector,this._errorClass=t.errorClass,this._form=n,this._buttonDefaultText=this._form.querySelector(this._submitButtonSelector).textContent}var t,n;return t=e,(n=[{key:"_showInputError",value:function(e){var t=this._form.querySelector("#"+e.id+"-error");e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)}},{key:"_hideInputError",value:function(e){var t=this._form.querySelector("#"+e.id+"-error");e.classList.remove(this._inputErrorClass),t.textContent="",t.classList.remove(this._errorClass)}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}},{key:"_toggleButtonState",value:function(e,t){e.every((function(e){return e.validity.valid}))?t.classList.remove(this._inactiveButtonClass):t.classList.add(this._inactiveButtonClass)}},{key:"_setEventListeners",value:function(){var e=this,t=Array.from(this._form.querySelectorAll(this._inputSelector)),n=this._form.querySelector(this._submitButtonSelector);n.addEventListener("click",(function(){t.forEach((function(t){e._checkInputValidity(t)}))})),this._toggleButtonState(t,n),t.forEach((function(r){r.addEventListener("input",(function(){e._checkInputValidity(r),e._toggleButtonState(t,n)}))}))}},{key:"recheckValiditiy",value:function(){var e=this,t=Array.from(this._form.querySelectorAll(this._inputSelector)),n=this._form.querySelector(this._submitButtonSelector);this._toggleButtonState(t,n),t.forEach((function(t){e._hideInputError(t)}))}},{key:"enableValidation",value:function(){this._form.addEventListener("submit",(function(e){e.preventDefault()})),this._setEventListeners()}},{key:"renderSaving",value:function(e){var t=this._form.querySelector(this._submitButtonSelector);e?(t.textContent="Saving...",t.disabled=!0):(t.textContent=this._buttonDefaultText,t.disabled=!1)}}])&&a(t.prototype,n),e}();function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popupElement=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this),this.open=this.open.bind(this),this.close=this.close.bind(this)}var t,n;return t=e,(n=[{key:"open",value:function(){this._popupElement.classList.add("popup_opened"),document.addEventListener("keyup",this._handleEscClose)}},{key:"close",value:function(){this._popupElement.classList.remove("popup_opened"),document.removeEventListener("keyup",this._handleEscClose)}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"setEventListeners",value:function(){var e=this;this._popupElement.addEventListener("click",(function(t){(t.target.classList.contains("popup__close-button")||t.target.classList.contains("popup"))&&e.close()}))}}])&&c(t.prototype,n),e}();function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=_(r);if(o){var n=_(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return d(this,e)});function a(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,e))._submitHandler=t,n}return t=a,(n=[{key:"_getInputValues",value:function(){var e={};return Array.from(this._form.querySelectorAll(".popup__input")).forEach((function(t){e[t.name]=t.value})),e}},{key:"setEventListeners",value:function(){var e=this;p(_(a.prototype),"setEventListeners",this).call(this),this._form=this._popupElement.querySelector(".popup__form"),this._form.addEventListener("submit",(function(t){t.preventDefault(),e._submitHandler(e._getInputValues())}))}},{key:"close",value:function(){p(_(a.prototype),"close",this).call(this),this._form.reset()}}])&&f(t.prototype,n),a}(s);function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t,n){return(b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=S(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=S(r);if(o){var n=S(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return g(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e))._previewImage=t._popupElement.querySelector(".preview-image__image"),t._previewCaption=t._popupElement.querySelector(".preview-image__caption"),t}return t=a,(n=[{key:"open",value:function(e,t){this._previewImage.src=t,this._previewCaption.textContent=e,b(S(a.prototype),"open",this).call(this)}}])&&m(t.prototype,n),a}(s);function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const w=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{name:this._name,about:this._about,id:this._id}}},{key:"setUserID",value:function(e){var t=e._id;this._id=t}},{key:"getUserID",value:function(){return this._id}},{key:"setAvatar",value:function(e){var t=this;r(e).then((function(n){document.querySelector(".profile__avatar").src=n.src,t._avatar=e})).catch((function(e){return console.log(e)}))}},{key:"setProfileInfo",value:function(e){var t=e.name,n=e.about;this._name=t,this._about=n,document.querySelector(".profile__name").textContent=this._name,document.querySelector(".profile__about").textContent=this._about}}])&&C(t.prototype,n),e}();function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const L=function(){function e(t){var n=t.baseUrl,r=t.headers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseUrl=n,this._headers=r}var t,n;return t=e,(n=[{key:"getInitialCards",value:function(){return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}))}},{key:"getUserInfo",value:function(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}))}},{key:"addCard",value:function(e){var t=e.name,n=e.link;return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers,method:"POST",body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}))}},{key:"deleteCard",value:function(e){var t=e.cardID;return fetch("".concat(this._baseUrl,"/cards/").concat(t),{headers:this._headers,method:"DELETE"}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}))}},{key:"updateCardLike",value:function(e){var t=e.cardID,n=e.like?"PUT":"DELETE";return fetch("".concat(this._baseUrl,"/cards/likes/").concat(t),{headers:this._headers,method:n}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}))}},{key:"setUserInfo",value:function(e){var t=e.name,n=e.about;return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers,method:"PATCH",body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}))}},{key:"setUserAvatar",value:function(e){var t=e.avatar;return fetch("".concat(this._baseUrl,"/users/me/avatar"),{headers:this._headers,method:"PATCH",body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}))}}])&&I(t.prototype,n),e}();var q,D,O=document.querySelector(".popup_type_profile"),j=document.querySelector(".popup_type_new-card"),P=document.querySelector(".popup_type_avatar"),U=document.querySelector(".popup_type_confirm"),B=O.querySelector(".popup__form"),T=j.querySelector(".popup__form"),R=P.querySelector(".popup__form"),x=U.querySelector(".popup__form"),A=B.querySelector(".popup__input_type_name"),V=B.querySelector(".popup__input_type_about"),H=document.querySelector(".profile__edit-button"),N=document.querySelector(".profile__add-button"),J=document.querySelector(".profile__avatar-edit-button"),z=new u(e,B),F=new u(e,T),M=new u(e,R),G=new u(e,x);z.enableValidation(),F.enableValidation(),M.enableValidation(),G.enableValidation();var K=new y(".popup_type_confirm",(function(){Q.deleteCard({cardID:q}).then((function(){D.remove(),K.close()})).catch((function(e){return console.log(e)}))}));K.setEventListeners();var Q=new L({baseUrl:"https://around.nomoreparties.co/v1/group-10",headers:{authorization:"60ad2ada-16d8-4dd8-b337-f86301ff39f8","Content-Type":"application/json"}}),W=new w;Q.getUserInfo().then((function(e){W.setProfileInfo(e),W.setUserID(e),W.setAvatar(e.avatar)})).then((function(){return Q.getInitialCards()})).then((function(e){function t(e){return new i({data:e,handleCardClick:function(e,t){return Z.open(e,t)},handleDeleteClick:function(e){var t=e.cardID,n=e.cardElement;q=t,D=n,K.open()},handleLikeClick:function(e){var t=e.cardID,n=e.card,r=n.getLiked({userID:W.getUserID()});Q.updateCardLike({cardID:t,like:!r}).then((function(e){n.updateLiked({userID:W.getUserID(),likes:e.likes})})).catch((function(e){return console.log(e)}))}},"#card-template")}var o=new n({items:e,renderer:function(e){var n=t(e);o.addItem(n.generateCard({userID:W.getUserID()})),n.updateLiked({userID:W.getUserID(),likes:e.likes})}},".elements__container");o.renderer();var a=new y(".popup_type_new-card",(function(e){F.renderSaving(!0),r(e.url).then((function(){return Q.addCard({name:e.title,link:e.url})})).then((function(e){var n=t(e);o.addItem(n.generateCard({userID:W.getUserID()})),a.close()})).catch((function(e){return console.log(e)})).finally((function(){F.renderSaving(!1)}))}));a.setEventListeners(),N.addEventListener("click",(function(){F.recheckValiditiy(),a.open()}))})).catch((function(e){return console.log(e)}));var X=new y(".popup_type_profile",(function(e){z.renderSaving(!0),Q.setUserInfo({name:e.name,about:e.about}).then((function(e){W.setProfileInfo({name:e.name,about:e.about}),X.close()})).catch((function(e){return console.log(e)})).finally((function(){z.renderSaving(!1)}))}));X.setEventListeners(),H.addEventListener("click",(function(){var e=W.getUserInfo();A.value=e.name,V.value=e.about,z.recheckValiditiy(),X.open()}));var Y=new y(".popup_type_avatar",(function(e){M.renderSaving(!0),r(e.url).then((function(){return Q.setUserAvatar({avatar:e.url})})).then((function(e){W.setAvatar(e.avatar),Y.close()})).catch((function(e){return console.log(e)})).finally((function(){M.renderSaving(!1)}))}));Y.setEventListeners(),J.addEventListener("click",(function(){M.recheckValiditiy(),Y.open()}));var Z=new E(".popup_type_preview");Z.setEventListeners()})();